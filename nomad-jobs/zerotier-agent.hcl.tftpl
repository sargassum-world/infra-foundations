job "zerotier_agent" {
  type = "system"
  datacenters = ["sargassum-foundations"]

  update {
    max_parallel = 1
  }

  group "${group}" {
    count = 1

    # network {
    #   port "zerotier" {
    #     static = 9993
    #   }
    # }

    task "zerotier_one" {
      driver = "docker"

      config {
        image = "zerotier/zerotier:1.10.1"
        # TODO: is this needed?
        # ports = ["zerotier"]
        # TODO: is this needed?
        # network_mode = "host"
        devices = [{
          host_path = "/dev/net/tun"
        }]
        cap_add = ["net_admin"]
      }

      # env {
      #   ZEROTIER_IDENTITY_SECRET = "${private_key}"
      #   ZEROTIER_IDENTITY_PUBLIC = "${public_key}"
      # }

      resources {
        cpu = 500
        memory = 128
      }
    }
  }
}
